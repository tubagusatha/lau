<div class="controls">
  <button class="play-button" id="toggleMusic">Play</button>
  <audio id="bgm" src="/img/you.mp3" preload="auto"></audio>

  <a href="/index.html" class="back-button">Back</a>
</div>
<script>
  const audio = document.getElementById("bgm");
  const button = document.getElementById("toggleMusic");

  button.addEventListener("click", () => {
    if (audio.paused) {
      audio.play();
      button.textContent = "Stop";
    } else {
      audio.pause();
      button.textContent = "Play";
    }
  });
</script>

<div class="container">
  <div class="main">
    <h2 class="first">My Fav Person</h2>
    <h2 class="second">My Fav Person</h2>
  </div>
  <div id="output"></div>
</div>

<video id="input" autoplay muted loop playsinline crossorigin="anonymous">
  <source src="/img/vid1.mp4" type="video/mp4" />
</video>

<canvas id="prerender" width="100" height="40"></canvas>

<style>
  :root {
    --color-primary: #ee75d2;
    --color-secondary: #75d8ee;
    --color-tertiary: #deee75;
    --color-quaternary: #9375ee;
    --color-surface: #271c22;
    --brightness: 1.5; /* Lebih cerah */
    font-size: 80%; /* Perbesar teks default */
  }
  .controls {
    position: fixed;
    inset: 10px 10px auto 10px;
    z-index: 10;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px;
  }
  .back-button {
    color: #242424;
    text-decoration: none;
    border-radius: 50px;
    padding: 0 20px;
    height: 50px;
    display: flex;
    align-items: center;
    background: aqua;
  }

  .play-button {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    background-color: #ff6b81;
    border: none;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    color: white;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s;
  }

  .play-button:hover {
    background-color: #4778ff;
    transform: scale(1.05);
  }
  body {
    width: 100vw;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: color-mix(in srgb, var(--color-surface), black 40%);
    color: var(--color-primary);
    overflow: hidden;
    margin: 0;
    gap: 20px; /* Jarak antara teks dan ASCII video */
  }

  .container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px; /* jarak antar elemen */
  }

  h2 {
    font-size: 120px;
    margin: 0;
    line-height: 1;
  }

  .first {
    color: transparent;
    -webkit-text-stroke: 2px #05a8f3;
  }

  .second {
    color: #05a8f3;
    -webkit-text-stroke: 2px #05a8f3;
    animation: waves 4s ease-in-out infinite;
    margin-top: -100px; /* Agar kedua teks menumpuk dengan efek stroke */
  }

  @keyframes waves {
    0%,
    100% {
      clip-path: polygon(
        0% 45%,
        16% 44%,
        33% 50%,
        54% 60%,
        70% 61%,
        84% 59%,
        100% 52%,
        100% 100%,
        0% 100%
      );
    }

    50% {
      clip-path: polygon(
        0% 60%,
        15% 65%,
        34% 66%,
        51% 62%,
        67% 50%,
        84% 45%,
        100% 46%,
        100% 100%,
        0% 100%
      );
    }
  }

  #output {
    position: relative;
    text-align: center;
    border-radius: 2rem;
    font-family: "SF Mono", monospace;
    overflow: hidden;
    filter: drop-shadow(
        0 0 10rem color-mix(in srgb, var(--color), transparent 20%)
      )
      brightness(var(--brightness));
    white-space: nowrap;
    background: black;
    font-size: 12px;
    line-height: 1;
  }

  #input,
  #prerender {
    display: none;
    position: absolute;
    left: 0;
    top: 0;
  }

  * {
    box-sizing: border-box;
  }

  @media (max-width: 768px) {
    h2 {
      font-size: 80px;
    }
    #output {
      font-size: 16px;
    }
  }
</style>

<script>
  (() => {
    const video = document.getElementById("input");
    const canvas = document.getElementById("prerender");
    const output = document.getElementById("output");
    const ctx = canvas.getContext("2d", { willReadFrequently: true });

    const charsFixed = [
      "_",
      ".",
      ",",
      "-",
      "=",
      "+",
      ":",
      ";",
      "c",
      "b",
      "a",
      "!",
      "?",
      "0",
      "1",
      "2",
      "3",
      "4",
      "5",
      "6",
      "7",
      ["9", "8"],
      ["✚", "✚", "✚", "✚", "✚", "⚛︎"],
      ["☺︎", "☹︎"],
      "☀︎",
      ["@", "#"],
      ["X", "Y", "Z"],
      "'",
    ];
    let chars = [...charsFixed];
    let charsLength = chars.length;
    const MAX_COLOR_INDEX = 255;

    const updateCanvas = () => {
      const w = canvas.width;
      const h = canvas.height;
      ctx.drawImage(video, 0, 0, w, h);
      const data = ctx.getImageData(0, 0, w, h).data;
      let outputText = "";

      for (let y = 0; y < h; y++) {
        let row = "";
        for (let x = 0; x < w; x++) {
          const index = (x + y * w) * 4;
          const [r, g, b] = data.slice(index, index + 3);
          const c = (r + g + b) / 3;
          const charIndex = Math.floor(
            (charsLength * ((c * 100) / MAX_COLOR_INDEX)) / 100
          );
          const result = chars[charIndex];
          const char = Array.isArray(result)
            ? result[Math.floor(Math.random() * result.length)]
            : result;

          row += `<span style="color: rgb(${r}, ${g}, ${b});">${
            char ?? "&nbsp;"
          }</span>`;
        }
        outputText += `<div>${row}</div>`;
      }
      output.innerHTML = outputText;
      output.style.setProperty(
        "--color",
        `rgb(${data[0]}, ${data[1]}, ${data[2]})`
      );

      setTimeout(() => requestAnimationFrame(updateCanvas), 0);
    };

    requestAnimationFrame(() => {
      video.play();
      updateCanvas();
    });
  })();
</script>
